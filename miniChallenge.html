<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Planning Mini Challenge ‚Äì Hybrid Learning</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --border: rgba(255,255,255,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --primary: #2D63FF;
      --primary2:#4B7BFF;
      --accent: #76E4FF;
      --radius-xl: 22px;
      --radius-lg: 18px;
      --container: 1120px;
    }
    *{ box-sizing:border-box; }
    html, body { height: 100%; }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#fff;
      color:#0f172a;

      /* ‚úÖ sticky footer */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main{ flex: 1; }

    a{ color:inherit; text-decoration:none; }
    .container{ width:min(var(--container), calc(100% - 40px)); margin:0 auto; }

    /* ===== Navbar (same) ===== */
    .topbar{
      position: sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(11, 18, 32, .70);
      border-bottom: 1px solid var(--border);
      color:#fff;
    }
    .topbar-inner{ height:64px; display:flex; align-items:center; justify-content:space-between; gap:14px; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; }
    /* .logo{
      width:34px;height:34px;border-radius:10px;
      background: radial-gradient(circle at 30% 30%, var(--accent), var(--primary));
      box-shadow: 0 10px 26px rgba(45,99,255,.35);
    } */
     .logo{
      width:44px;height:44px;border-radius:10px;
      background: radial-gradient(circle at 30% 30%, var(--accent), var(--primary));
      box-shadow: 0 10px 26px rgba(45,99,255,.35);
    }
    .footerlogo{
      width:34px;height:34px;border-radius:10px;
      background: radial-gradient(circle at 30% 30%, var(--accent), var(--primary));
      box-shadow: 0 10px 26px rgba(45,99,255,.35);
    }
    .nav{ display:flex; gap:18px; align-items:center; color: rgba(255,255,255,.72); font-weight:600; font-size:14px; }
    .nav a{ padding:10px 10px; border-radius:10px; }
    .nav a:hover{ background: rgba(255,255,255,.06); color:#fff; }

    .actions{ display:flex; gap:10px; align-items:center; }
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color:#fff;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight:700;
      font-size: 14px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
    }
    .btn-primary{
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      border-color: rgba(255,255,255,.0);
      box-shadow: 0 14px 36px rgba(45,99,255,.35);
    }
    .hamburger{ display:none; width:42px;height:42px;border-radius:12px; border:1px solid var(--border); background: rgba(255,255,255,.04); color:#fff; cursor:pointer; }
    .mobile-nav{ display:none; }

    /* ===== Hero ===== */
    .pageHero{
      background: linear-gradient(90deg, #1E4DFF 0%, #2D63FF 45%, #2A5BFF 100%);
      color:#fff; box-shadow: var(--shadow);
    }
    .pageHero .container{ padding: 44px 0; }
    .pageHero h1{ margin:0 0 10px; font-size: clamp(26px, 3vw, 40px); letter-spacing:-.8px; }
    .pageHero p{ margin:0; color: rgba(255,255,255,.86); font-weight:600; line-height:1.8; max-width: 78ch; }

    /* ===== Mini Challenge UI ===== */
    section{ padding: 26px 0; }

    .layout{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
      align-items:start;
    }
    .panel{
      border:1px solid #e6eaf2;
      background:#fff;
      border-radius: var(--radius-xl);
      padding: 16px;
      box-shadow: 0 10px 26px rgba(15,23,42,.08);
    }
    .panel h2{
      margin: 0 0 8px;
      font-size: 16px;
      letter-spacing: -.2px;
      font-weight: 900;
    }
    .muted{
      margin:0;
      color:#475569;
      font-size: 13px;
      font-weight: 650;
      line-height: 1.6;
    }
    .badgeRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid #e6eaf2;
      background: #f8fafc;
      color: rgba(15,23,42,.72);
      font-weight: 800;
      font-size: 12px;
    }

    .step{
      border:1px solid #e6eaf2;
      border-radius: var(--radius-lg);
      padding: 14px;
      box-shadow: 0 10px 26px rgba(15,23,42,.06);
      margin-top: 12px;
      background:#fff;
    }
    .stepTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .stepTitle{
      font-weight: 950;
      font-size: 14px;
      margin:0;
      letter-spacing: -.2px;
    }
    .stepPill{
      font-size: 11px;
      font-weight: 900;
      color: rgba(15,23,42,.55);
      border:1px solid #e6eaf2;
      background:#f8fafc;
      border-radius: 999px;
      padding: 6px 10px;
      white-space: nowrap;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    input[type="text"], select, textarea{
      width: 100%;
      border: 1px solid #e6eaf2;
      border-radius: 14px;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 700;
      color:#0f172a;
      outline: none;
      background:#fff;
    }
    textarea{ min-height: 96px; resize: vertical; }
    label.small{
      display:block;
      font-size: 12px;
      font-weight: 850;
      color: rgba(15,23,42,.72);
      margin: 0 0 6px;
    }

    .hint{
      margin-top: 10px;
      border: 1px solid rgba(45,99,255,.20);
      background: rgba(45,99,255,.06);
      color: rgba(15,23,42,.78);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 800;
      font-size: 12.5px;
      line-height: 1.5;
    }

    .progressCard{
      border:1px solid #e6eaf2;
      background:#fff;
      border-radius: var(--radius-lg);
      padding: 14px;
      box-shadow: 0 10px 26px rgba(15,23,42,.06);
      margin-top: 12px;
    }
    .progressTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .big{
      font-size: 22px;
      font-weight: 950;
      letter-spacing: -.5px;
    }
    .smallTxt{
      color:#475569;
      font-size: 12px;
      font-weight: 750;
      margin-top: 4px;
    }
    .progressBar{
      height: 10px;
      width: 100%;
      border-radius: 999px;
      border:1px solid #e6eaf2;
      background: #f8fafc;
      overflow:hidden;
      margin-top: 10px;
    }
    .progressFill{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      border-radius: 999px;
      transition: width .2s ease;
    }

    .btnRow{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
      margin-top: 14px;
    }
    .primaryBtn{
      border: 1px solid rgba(45,99,255,.25);
      background: linear-gradient(90deg, rgba(45,99,255,.10), rgba(75,123,255,.10));
      color: var(--primary);
      padding: 11px 14px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
    }
    .primaryBtn:disabled{ opacity: .45; cursor:not-allowed; }

    .dangerBtn{
      border:1px solid rgba(239,68,68,.25);
      background: rgba(239,68,68,.06);
      color:#b91c1c;
      padding: 11px 14px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 13px;
      cursor:pointer;
    }

    .error{
      margin-top: 10px;
      border: 1px solid rgba(239,68,68,.25);
      background: rgba(239,68,68,.06);
      color: #b91c1c;
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 850;
      font-size: 12.5px;
      line-height: 1.5;
      display:none;
    }
    .success{
      margin-top: 10px;
      border: 1px solid rgba(34,197,94,.25);
      background: rgba(34,197,94,.07);
      color: #166534;
      border-radius: 14px;
      padding: 12px 12px;
      font-weight: 850;
      font-size: 12.5px;
      line-height: 1.5;
      display:none;
    }

    .note{
      margin-top: 14px;
      border:1px solid #e6eaf2;
      border-radius: var(--radius-xl);
      padding: 14px;
      background: #fff;
      box-shadow: 0 12px 30px rgba(15,23,42,.08);
      color:#475569;
      font-weight:650;
      font-size:13px;
      line-height:1.6;
    }
    .note strong{ color:#0f172a; }

    /* ===== Footer (same) ===== */
    footer{ margin-top: 18px; background:#0b1220; color: rgba(255,255,255,.82); }
    .footer__inner{
      padding: 28px 0 26px;
      display:grid;
      grid-template-columns: 1.4fr 1fr 1fr .9fr;
      gap: 26px;
    }
    .footer__brandRow{ display:flex; align-items:center; gap:10px; margin-bottom: 10px; }
    .footer__brandName{ font-weight: 900; font-size: 14px; letter-spacing: .2px; }
    .footer__desc{ margin:0; max-width:34ch; color: rgba(255,255,255,.58); font-size:12px; line-height:1.7; font-weight:600; }
    .footerCol h5{ margin:0 0 10px; font-size:12px; font-weight:900; color: rgba(255,255,255,.86); }
    .footerCol a:not(.socialBtn){ display:block; padding: 6px 0; color: rgba(255,255,255,.58); font-size:12px; font-weight:600; }
    .footerCol a:not(.socialBtn):hover{ color:#fff; }
    .footer__social{ display:flex; gap:10px; }
    .footerCol a.socialBtn{
      width: 28px; height: 28px; display:grid; place-items:center;
      border-radius: 8px; border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04); color: rgba(255,255,255,.78);
    }
    .footerCol a.socialBtn svg{ display:block; width:14px; height:14px; }
    .footerBottom{
      border-top: 1px solid rgba(255,255,255,.08);
      padding: 12px 0 14px;
      color: rgba(255,255,255,.45);
      font-size: 11px;
      font-weight: 600;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    @media (max-width: 980px){
      .nav{ display:none; }
      .hamburger{ display:inline-flex; align-items:center; justify-content:center; }
      .mobile-nav{ display:none; padding: 12px 0 14px; border-top: 1px solid var(--border); }
      .mobile-nav a{ display:block; padding: 10px 4px; color: rgba(255,255,255,.72); font-weight:700; }
      .mobile-nav a:hover{ color:#fff; }
      .mobile-nav.show{ display:block; }
      .footer__inner{ grid-template-columns: 1fr 1fr; }

      .layout{ grid-template-columns: 1fr; }
      .grid2{ grid-template-columns: 1fr; }
    }
    @media (max-width: 520px){
      .footer__inner{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- ===== NAVBAR ===== -->
  <header class="topbar">
    <div class="container">
      <div class="topbar-inner">
        <a class="brand" href="index.html">
          <div class="logo" aria-hidden="true"><img class="logo" src="ProjectThriveLogo.jpg" alt="Project Thrive Logo"/></div>
          <span>Project Thrive</span>
        </a>

        <nav class="nav" aria-label="Primary">
          <a href="events.html">Events</a>
          <a href="hybrid-learning.html">Hybrid Learning</a>
          <a href="rewardsPage.html">Rewards</a>
          <a href="ambassadors.html">Ambassadors</a>
        </nav>

        <div class="actions">
          <a class="btn" href="quizzes.html">Back</a>
          <a class="btn btn-primary" href="hybrid-learning.html">Hybrid Hub</a>
          <button class="hamburger" type="button" id="hamburger" aria-label="Open menu">‚ò∞</button>
        </div>
      </div>

      <div class="mobile-nav" id="mobileNav" aria-label="Mobile">
        <a href="events.html" onclick="closeMobileNav()">Events</a>
        <a href="hybrid-learning.html" onclick="closeMobileNav()">Hybrid Learning</a>
        <a href="rewardsPage.html" onclick="closeMobileNav()">Rewards</a>
        <a href="ambassadors.html" onclick="closeMobileNav()">Ambassadors</a>
      </div>
    </div>
  </header>

  <!-- ===== HERO ===== -->
  <div class="pageHero">
    <div class="container">
      <h1>Planning Mini Challenge</h1>
      <p>Build a 1-day reset plan in 4 minutes.</p>
    </div>
  </div>

  <!-- ===== MAIN ===== -->
  <main>
    <section>
      <div class="container">
        <div class="layout">
          <!-- Left: steps -->
          <div class="panel">
            <h2>Your 1-Day Reset Plan</h2>
            <p class="muted">Complete all steps to finish.</p>

            <!-- <div class="badgeRow">
              <span class="pill">üìå Planning</span>
              <span class="pill">‚úÖ Must complete all</span>
              <span class="pill">üíæ Saved on device</span>
            </div> -->

            <!-- Step 1 -->
            <div class="step" id="step1">
              <div class="stepTop">
                <p class="stepTitle">Step 1 ‚Äî Pick 3 priorities for tomorrow</p>
                <span class="stepPill" id="step1Pill">Incomplete</span>
              </div>

              <div class="grid2">
                <div>
                  <label class="small" for="p1">Priority 1</label>
                  <input id="p1" type="text" placeholder="e.g. Finish assignment outline" maxlength="80">
                </div>
                <div>
                  <label class="small" for="p2">Priority 2</label>
                  <input id="p2" type="text" placeholder="e.g. Revise 2 topics" maxlength="80">
                </div>
                <div>
                  <label class="small" for="p3">Priority 3</label>
                  <input id="p3" type="text" placeholder="e.g. 20-min workout" maxlength="80">
                </div>
              </div>

              <div class="hint">Priorities should be realistic.</div>
            </div>

            <!-- Step 2 -->
            <div class="step" id="step2">
              <div class="stepTop">
                <p class="stepTitle">Step 2 ‚Äî Set a time for each priority</p>
                <span class="stepPill" id="step2Pill">Incomplete</span>
              </div>

              <div class="grid2">
                <div>
                  <label class="small" for="t1">Priority 1</label>
                  <select id="t1">
                    <option value="">Select</option>
                    <option>Morning (8am‚Äì12pm)</option>
                    <option>Afternoon (12pm‚Äì5pm)</option>
                    <option>Evening (5pm‚Äì9pm)</option>
                    <option>Night (9pm‚Äì12am)</option>
                  </select>
                </div>
                <div>
                  <label class="small" for="t2">Priority 2</label>
                  <select id="t2">
                    <option value="">Select</option>
                    <option>Morning (8am‚Äì12pm)</option>
                    <option>Afternoon (12pm‚Äì5pm)</option>
                    <option>Evening (5pm‚Äì9pm)</option>
                    <option>Night (9pm‚Äì12am)</option>
                  </select>
                </div>
                <div>
                  <label class="small" for="t3">Priority 3</label>
                  <select id="t3">
                    <option value="">Select</option>
                    <option>Morning (8am‚Äì12pm)</option>
                    <option>Afternoon (12pm‚Äì5pm)</option>
                    <option>Evening (5pm‚Äì9pm)</option>
                    <option>Night (9pm‚Äì12am)</option>
                  </select>
                </div>
              </div>

              <div class="hint">Put the hardest task earlier for when your energy is higher.</div>
            </div>

            <!-- Step 3 -->
            <div class="step" id="step3">
              <div class="stepTop">
                <p class="stepTitle">Step 3 ‚Äî Choose 1 quick win (‚â§ 10 minutes)</p>
                <span class="stepPill" id="step3Pill">Incomplete</span>
              </div>

              <label class="small" for="quickWin">Quick win</label>
              <input id="quickWin" type="text" placeholder="e.g. Prepare materials" maxlength="80">
              <div class="hint">Quick wins make it easier to start.</div>
            </div>

            <!-- Step 4 -->
            <div class="step" id="step4">
              <div class="stepTop">
                <p class="stepTitle">Step 4 ‚Äî Reflection</p>
                <span class="stepPill" id="step4Pill">Incomplete</span>
              </div>

              <label class="small" for="reflection">What will make tomorrow feel like a win?</label>
              <textarea id="reflection" placeholder="Example: If I finish Priority 1."></textarea>
              <div class="hint">Short is fine ‚Äî you just need a clear ‚Äúwhy‚Äù.</div>
            </div>

            <div class="btnRow">
              <button class="dangerBtn" id="resetBtn" type="button">Reset</button>
              <button class="primaryBtn" id="finishBtn" type="button" disabled>Finish challenge ‚Üí</button>
            </div>

            <div class="error" id="errorBox" role="alert"></div>
            <div class="success" id="successBox" role="status"></div>
          </div>

          <!-- Right: progress + summary -->
          <div class="panel">
            <h2>Progress</h2>
            <p class="muted">Complete all 4 steps to earn a ‚Äúskill badge‚Äù (demo).</p>

            <div class="progressCard">
              <div class="progressTop">
                <div>
                  <div class="big"><span id="doneSteps">0</span> / 4</div>
                  <div class="smallTxt">Steps completed</div>
                </div>
                <div style="text-align:right;">
                  <div class="big" id="statusText">Not ready</div>
                  <div class="smallTxt">Finish status</div>
                </div>
              </div>
              <div class="progressBar" aria-hidden="true">
                <div class="progressFill" id="progressFill"></div>
              </div>
            </div>

            <div class="note" style="margin-top:12px;">
              <strong>Your plan preview:</strong>
              <div style="margin-top:10px; display:grid; gap:8px;">
                <div><span class="pill" style="border-color:rgba(45,99,255,.18);">Priority 1</span> <span id="prev1" class="muted">‚Äî</span></div>
                <div><span class="pill" style="border-color:rgba(45,99,255,.18);">Priority 2</span> <span id="prev2" class="muted">‚Äî</span></div>
                <div><span class="pill" style="border-color:rgba(45,99,255,.18);">Priority 3</span> <span id="prev3" class="muted">‚Äî</span></div>
                <div><span class="pill" style="border-color:rgba(45,99,255,.18);">Quick win</span> <span id="prevQ" class="muted">‚Äî</span></div>
              </div>
            </div>

            <!-- <div class="note" style="margin-top:12px;">
              <strong>Next step idea:</strong> After finishing, show a ‚ÄúWhat‚Äôs next?‚Äù button to recommend the quiz or sleep challenge.
            </div> -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer>
    <div class="container">
      <div class="footer__inner">
        <div>
          <div class="footer__brandRow">
            <div class="logo" aria-hidden="true" style="width:28px;height:28px;border-radius:10px;"><img class="footerlogo" src="ProjectThriveLogo.jpg" alt="Project Thrive Logo"/></div>
            <span class="footer__brandName">Project Thrive</span>
          </div>
          <p class="footer__desc">
            Empowering Singapore‚Äôs youth through innovative health programmes and community engagement.
          </p>
        </div>

        <div class="footerCol">
          <h5>Programme</h5>
          <a href="events.html">Events</a>
          <a href="hybrid-learning.html">Hybrid Learning</a>
          <a href="rewardsPage.html">Rewards</a>
          <a href="ambassadors.html">Ambassadors</a>
        </div>

        <div class="footerCol">
          <h5>Support</h5>
          <a href="index.html#top">Help Center</a>
          <a href="index.html#top">Contact Us</a>
          <a href="index.html#top">FAQ</a>
        </div>

        <!-- <div class="footerCol">
          <h5>Connect</h5>
          <div class="footer__social" aria-label="Social links">
            <a class="socialBtn" href="#" aria-label="Instagram">‚óé</a>
            <a class="socialBtn" href="#" aria-label="TikTok">‚ô™</a>
            <a class="socialBtn" href="#" aria-label="YouTube">‚ñ∂</a>
          </div>
        </div> -->
        <div class="footerCol">
          <h5>Connect</h5>

          <div class="footer__social" aria-label="Social links">
            <a class="socialBtn" href="#" aria-label="Instagram">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Z"
                      stroke="currentColor" stroke-width="2"/>
                <path d="M12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z"
                      stroke="currentColor" stroke-width="2"/>
                <path d="M17.5 6.5h.01"
                      stroke="currentColor" stroke-width="3"
                      stroke-linecap="round"/>
              </svg>
            </a>

            <a class="socialBtn" href="#" aria-label="TikTok">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M14 3v10.5a4.5 4.5 0 1 1-4-4.47"
                      stroke="currentColor" stroke-width="2"
                      stroke-linecap="round"/>
                <path d="M14 3c1.3 2.2 3.2 3.6 6 3.9"
                      stroke="currentColor" stroke-width="2"
                      stroke-linecap="round"/>
              </svg>
            </a>

            <a class="socialBtn" href="#" aria-label="YouTube">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M21 12s0-3.6-.5-5.1a3 3 0 0 0-2.1-2.1C16.9 4.2 12 4.2 12 4.2s-4.9 0-6.4.6A3 3 0 0 0 3.5 6.9C3 8.4 3 12 3 12s0 3.6.5 5.1a3 3 0 0 0 2.1 2.1c1.5.6 6.4.6 6.4.6s4.9 0 6.4-.6a3 3 0 0 0 2.1-2.1c.5-1.5.5-5.1.5-5.1Z"
                      stroke="currentColor" stroke-width="2"/>
                <path d="M10 15.2V8.8L16 12l-6 3.2Z"
                      fill="currentColor"/>
              </svg>
            </a>
          </div>
        </div>
      </div>

      <div class="footerBottom">
        <span>¬© <span id="year"></span> Project Thrive</span>
      </div>
    </div>
  </footer>

  <script>
    // ===== Navbar JS =====
    const hamburger = document.getElementById("hamburger");
    const mobileNav = document.getElementById("mobileNav");
    function closeMobileNav(){ mobileNav?.classList.remove("show"); }
    hamburger?.addEventListener("click", () => mobileNav.classList.toggle("show"));
    document.getElementById("year").textContent = new Date().getFullYear();

    // ===== Mini Challenge Logic =====
    const STORAGE_KEY = "nhg_planning_mini_v1";

    const els = {
      p1: document.getElementById("p1"),
      p2: document.getElementById("p2"),
      p3: document.getElementById("p3"),
      t1: document.getElementById("t1"),
      t2: document.getElementById("t2"),
      t3: document.getElementById("t3"),
      quickWin: document.getElementById("quickWin"),
      reflection: document.getElementById("reflection"),

      step1Pill: document.getElementById("step1Pill"),
      step2Pill: document.getElementById("step2Pill"),
      step3Pill: document.getElementById("step3Pill"),
      step4Pill: document.getElementById("step4Pill"),

      doneSteps: document.getElementById("doneSteps"),
      statusText: document.getElementById("statusText"),
      progressFill: document.getElementById("progressFill"),

      finishBtn: document.getElementById("finishBtn"),
      resetBtn: document.getElementById("resetBtn"),

      errorBox: document.getElementById("errorBox"),
      successBox: document.getElementById("successBox"),

      prev1: document.getElementById("prev1"),
      prev2: document.getElementById("prev2"),
      prev3: document.getElementById("prev3"),
      prevQ: document.getElementById("prevQ"),
    };

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        return JSON.parse(raw);
      }catch(e){ return null; }
    }
    function save(data){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }catch(e){}
    }
    function clearMsgs(){
      els.errorBox.style.display = "none";
      els.successBox.style.display = "none";
      els.errorBox.textContent = "";
      els.successBox.textContent = "";
    }
    function showError(msg){
      els.errorBox.textContent = msg;
      els.errorBox.style.display = "block";
    }
    function showSuccess(msg){
      els.successBox.textContent = msg;
      els.successBox.style.display = "block";
    }

    function getData(){
      return {
        p1: els.p1.value.trim(),
        p2: els.p2.value.trim(),
        p3: els.p3.value.trim(),
        t1: els.t1.value,
        t2: els.t2.value,
        t3: els.t3.value,
        quickWin: els.quickWin.value.trim(),
        reflection: els.reflection.value.trim(),
        finishedAt: null
      };
    }

    function setData(d){
      els.p1.value = d.p1 || "";
      els.p2.value = d.p2 || "";
      els.p3.value = d.p3 || "";
      els.t1.value = d.t1 || "";
      els.t2.value = d.t2 || "";
      els.t3.value = d.t3 || "";
      els.quickWin.value = d.quickWin || "";
      els.reflection.value = d.reflection || "";
    }

    function stepStatus(done){
      return done ? "Complete" : "Incomplete";
    }

    function updatePreview(d){
      els.prev1.textContent = d.p1 ? `${d.p1}${d.t1 ? ` (${d.t1})` : ""}` : "‚Äî";
      els.prev2.textContent = d.p2 ? `${d.p2}${d.t2 ? ` (${d.t2})` : ""}` : "‚Äî";
      els.prev3.textContent = d.p3 ? `${d.p3}${d.t3 ? ` (${d.t3})` : ""}` : "‚Äî";
      els.prevQ.textContent = d.quickWin ? d.quickWin : "‚Äî";
    }

    function computeProgress(d){
      const step1 = !!(d.p1 && d.p2 && d.p3);
      const step2 = !!(d.t1 && d.t2 && d.t3);
      const step3 = !!d.quickWin;
      const step4 = !!d.reflection;

      const done = [step1, step2, step3, step4].filter(Boolean).length;

      els.step1Pill.textContent = stepStatus(step1);
      els.step2Pill.textContent = stepStatus(step2);
      els.step3Pill.textContent = stepStatus(step3);
      els.step4Pill.textContent = stepStatus(step4);

      els.doneSteps.textContent = String(done);
      els.progressFill.style.width = Math.round((done/4)*100) + "%";

      const ready = done === 4;
      els.finishBtn.disabled = !ready;
      els.statusText.textContent = ready ? "Ready" : "Not ready";

      updatePreview(d);
      return { ready };
    }

    function persist(){
      const d = getData();
      save(d);
      computeProgress(d);
    }

    // Init
    const stored = load();
    if (stored) setData(stored);
    persist();

    // Listen changes (autosave)
    ["input", "change"].forEach(evt => {
      document.addEventListener(evt, (e) => {
        if (
          e.target === els.p1 || e.target === els.p2 || e.target === els.p3 ||
          e.target === els.t1 || e.target === els.t2 || e.target === els.t3 ||
          e.target === els.quickWin || e.target === els.reflection
        ){
          clearMsgs();
          persist();
        }
      }, true);
    });

    // Finish
    els.finishBtn.addEventListener("click", () => {
      clearMsgs();
      const d = getData();
      const { ready } = computeProgress(d);
      if (!ready){
        showError("Please complete all steps before finishing.");
        return;
      }
      d.finishedAt = new Date().toISOString();
      save(d);

      showSuccess("Completed! You earned a Badge.");

      // Optional: disable inputs after completion
      // If you want users to still edit after finishing, remove the block below.
      [els.p1, els.p2, els.p3, els.t1, els.t2, els.t3, els.quickWin, els.reflection].forEach(x => x.disabled = true);
      els.finishBtn.disabled = true;
      els.statusText.textContent = "Completed";
    });

    // Reset
    els.resetBtn.addEventListener("click", () => {
      const ok = confirm("Reset your mini challenge plan? This clears your saved inputs.");
      if (!ok) return;
      localStorage.removeItem(STORAGE_KEY);
      [els.p1, els.p2, els.p3, els.t1, els.t2, els.t3, els.quickWin, els.reflection].forEach(x => {
        x.disabled = false;
        if (x.tagName === "SELECT") x.value = "";
        else x.value = "";
      });
      clearMsgs();
      persist();
    });
  </script>
</body>
</html>
